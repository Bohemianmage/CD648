export const weeklyRatesByRoomId = {
  // 1 = Ejecutiva
  3: {
    1: { weekday: 2080, weekend: 2288 },
    2: { weekday: 2080, weekend: 2288 },
    3: { weekday: 2080, weekend: 2288 },
    4: { weekday: 2080, weekend: 2288 },
    5: { weekday: 2405, weekend: 2645 },
    6: { weekday: 2405, weekend: 2645 },
    7: { weekday: 2405, weekend: 2645 },
    8: { weekday: 2405, weekend: 2645 },
    9: { weekday: 2405, weekend: 2645 },
    10: { weekday: 2405, weekend: 2645 },
    11: { weekday: 2405, weekend: 2645 },
    12: { weekday: 2660, weekend: 2926 },
    13: { weekday: 2660, weekend: 2926 },
    14: { weekday: 2660, weekend: 2926 },
    15: { weekday: 2660, weekend: 2926 },
    16: { weekday: 2660, weekend: 2926 },
    17: { weekday: 2660, weekend: 2926 },
    18: { weekday: 2660, weekend: 2926 },
    19: { weekday: 2660, weekend: 2926 },
    20: { weekday: 2925, weekend: 3218 },
    21: { weekday: 2925, weekend: 3218 },
    22: { weekday: 2925, weekend: 3218 },
    23: { weekday: 2925, weekend: 3218 },
    24: { weekday: 2600, weekend: 2860 },
    25: { weekday: 4160, weekend: 4576 },
    26: { weekday: 4160, weekend: 4576 },
    27: { weekday: 4664, weekend: 5129 },
    28: { weekday: 4164, weekend: 4580 },
    29: { weekday: 3831, weekend: 4213 },
    30: { weekday: 3331, weekend: 3664 },
    31: { weekday: 2665, weekend: 2931 },
    32: { weekday: 2665, weekend: 2931 },
    33: { weekday: 2665, weekend: 2931 },
    34: { weekday: 2665, weekend: 2931 },
    35: { weekday: 2665, weekend: 2931 },
    36: { weekday: 2470, weekend: 2717 },
    37: { weekday: 2470, weekend: 2717 },
    38: { weekday: 2470, weekend: 2717 },
    39: { weekday: 2470, weekend: 2717 },
    40: { weekday: 2600, weekend: 2860 },
    41: { weekday: 2600, weekend: 2860 },
    42: { weekday: 2600, weekend: 2860 },
    43: { weekday: 3120, weekend: 3432 },
    44: { weekday: 2600, weekend: 2860 },
    45: { weekday: 2860, weekend: 3146 },
    46: { weekday: 2860, weekend: 3146 },
    47: { weekday: 2860, weekend: 3146 },
    48: { weekday: 2860, weekend: 3146 },
    49: { weekday: 2990, weekend: 3289 },
    50: { weekday: 2990, weekend: 3289 },
    51: { weekday: 2990, weekend: 3289 },
    52: { weekday: 2990, weekend: 3289 },
    53: { weekday: 2080, weekend: 2288 },
  },
  // 2 = Terraza
  2: {
    1: { weekday: 1839, weekend: 2024 },
    2: { weekday: 1839, weekend: 2024 },
    3: { weekday: 1839, weekend: 2024 },
    4: { weekday: 1839, weekend: 2024 },
    5: { weekday: 2127, weekend: 2340 },
    6: { weekday: 2127, weekend: 2340 },
    7: { weekday: 2127, weekend: 2340 },
    8: { weekday: 2127, weekend: 2340 },
    9: { weekday: 2127, weekend: 2340 },
    10: { weekday: 2127, weekend: 2340 },
    11: { weekday: 2127, weekend: 2340 },
    12: { weekday: 2357, weekend: 2592 },
    13: { weekday: 2357, weekend: 2592 },
    14: { weekday: 2357, weekend: 2592 },
    15: { weekday: 2357, weekend: 2592 },
    16: { weekday: 2357, weekend: 2592 },
    17: { weekday: 2357, weekend: 2592 },
    18: { weekday: 2357, weekend: 2592 },
    19: { weekday: 2357, weekend: 2592 },
    20: { weekday: 2587, weekend: 2846 },
    21: { weekday: 2587, weekend: 2846 },
    22: { weekday: 2587, weekend: 2846 },
    23: { weekday: 2587, weekend: 2846 },
    24: { weekday: 2299, weekend: 2530 },
    25: { weekday: 3678, weekend: 4048 },
    26: { weekday: 3678, weekend: 4048 },
    27: { weekday: 4125, weekend: 4538 },
    28: { weekday: 3683, weekend: 4052 },
    29: { weekday: 3388, weekend: 3727 },
    30: { weekday: 2946, weekend: 3241 },
    31: { weekday: 2357, weekend: 2593 },
    32: { weekday: 2357, weekend: 2593 },
    33: { weekday: 2357, weekend: 2593 },
    34: { weekday: 2357, weekend: 2593 },
    35: { weekday: 2357, weekend: 2593 },
    36: { weekday: 2180, weekend: 2398 },
    37: { weekday: 2180, weekend: 2398 },
    38: { weekday: 2180, weekend: 2398 },
    39: { weekday: 2180, weekend: 2398 },
    40: { weekday: 2990, weekend: 3290 },
    41: { weekday: 2990, weekend: 3290 },
    42: { weekday: 2990, weekend: 3290 },
    43: { weekday: 3588, weekend: 3947 },
    44: { weekday: 2990, weekend: 3290 },
    45: { weekday: 2530, weekend: 2783 },
    46: { weekday: 2530, weekend: 2783 },
    47: { weekday: 2530, weekend: 2783 },
    48: { weekday: 2530, weekend: 2783 },
    49: { weekday: 2645, weekend: 2909 },
    50: { weekday: 2645, weekend: 2909 },
    51: { weekday: 2645, weekend: 2909 },
    52: { weekday: 2645, weekend: 2909 },
    53: { weekday: 1839, weekend: 2024 },
  },
  // 3 = Compacta
  1: {
    1: { weekday: 1600, weekend: 1760 },
    2: { weekday: 1600, weekend: 1760 },
    3: { weekday: 1600, weekend: 1760 },
    4: { weekday: 1600, weekend: 1760 },
    5: { weekday: 1850, weekend: 2035 },
    6: { weekday: 1850, weekend: 2035 },
    7: { weekday: 1850, weekend: 2035 },
    8: { weekday: 1850, weekend: 2035 },
    9: { weekday: 1850, weekend: 2035 },
    10: { weekday: 1850, weekend: 2035 },
    11: { weekday: 1850, weekend: 2035 },
    12: { weekday: 2050, weekend: 2255 },
    13: { weekday: 2050, weekend: 2255 },
    14: { weekday: 2050, weekend: 2255 },
    15: { weekday: 2050, weekend: 2255 },
    16: { weekday: 2050, weekend: 2255 },
    17: { weekday: 2050, weekend: 2255 },
    18: { weekday: 2050, weekend: 2255 },
    19: { weekday: 2050, weekend: 2255 },
    20: { weekday: 2250, weekend: 2475 },
    21: { weekday: 2250, weekend: 2475 },
    22: { weekday: 2250, weekend: 2475 },
    23: { weekday: 2250, weekend: 2475 },
    24: { weekday: 2000, weekend: 2200 },
    25: { weekday: 3200, weekend: 3520 },
    26: { weekday: 3200, weekend: 3520 },
    27: { weekday: 3588, weekend: 3946 },
    28: { weekday: 3203, weekend: 3523 },
    29: { weekday: 2947, weekend: 3242 },
    30: { weekday: 2563, weekend: 2819 },
    31: { weekday: 2050, weekend: 2255 },
    32: { weekday: 2050, weekend: 2255 },
    33: { weekday: 2050, weekend: 2255 },
    34: { weekday: 2050, weekend: 2255 },
    35: { weekday: 2050, weekend: 2255 },
    36: { weekday: 1900, weekend: 2090 },
    37: { weekday: 1900, weekend: 2090 },
    38: { weekday: 1900, weekend: 2090 },
    39: { weekday: 1900, weekend: 2090 },
    40: { weekday: 2600, weekend: 2860 },
    41: { weekday: 2600, weekend: 2860 },
    42: { weekday: 2600, weekend: 2860 },
    43: { weekday: 3120, weekend: 3432 },
    44: { weekday: 2600, weekend: 2860 },
    45: { weekday: 2200, weekend: 2420 },
    46: { weekday: 2200, weekend: 2420 },
    47: { weekday: 2200, weekend: 2420 },
    48: { weekday: 2200, weekend: 2420 },
    49: { weekday: 2300, weekend: 2530 },
    50: { weekday: 2300, weekend: 2530 },
    51: { weekday: 2300, weekend: 2530 },
    52: { weekday: 2300, weekend: 2530 },
    53: { weekday: 1600, weekend: 1760 },
  },
};

// -----------------------------------------------------------------------------
// 2) Mapa de asignación de IDs (por si los precios están "invertidos")
// -----------------------------------------------------------------------------
//
// ROOM_ID_TO_RATE_ID traduce el ID de habitación que maneja tu front/back
// al ID que se usa en weeklyRatesByRoomId.
//
// Por defecto es identidad (1->1, 2->2, 3->3).
// Si detectas que, por ejemplo, la habitación con id 1 en tu UI es Compacta,
// pero en la tabla weeklyRatesByRoomId[3] está Compacta, entonces cambiarías a:
//   const ROOM_ID_TO_RATE_ID = { 1: 3, 2: 2, 3: 1 };

const ROOM_ID_TO_RATE_ID = {
  1: 1,
  2: 2,
  3: 3,
};

// -----------------------------------------------------------------------------
// 3) Helpers de fechas: semanas y fines de semana
// -----------------------------------------------------------------------------

const MS_PER_DAY = 24 * 60 * 60 * 1000;

export function getRatesWeekIndex(date) {
  const year = date.getFullYear();
  const dayDate = new Date(year, date.getMonth(), date.getDate());
  const startOfYear = new Date(year, 0, 1); // 1 enero

  const diffDays = Math.floor((dayDate.getTime() - startOfYear.getTime()) / MS_PER_DAY);
  const rawWeek = Math.floor(diffDays / 7) + 1;

  if (rawWeek < 1) return 1;
  if (rawWeek > 53) return 53;
  return rawWeek;
}

export function isWeekend(date) {
  const day = date.getDay(); // 0=domingo .. 6=sábado
  return day === 5 || day === 6;
}

export function getNightBaseRate(tipoHabitacionId, fecha) {
  // Mapeo de ID lógico -> ID de tabla de tarifas
  const rateId = ROOM_ID_TO_RATE_ID[tipoHabitacionId] ?? tipoHabitacionId;

  const weeksForRoom = weeklyRatesByRoomId[rateId];
  if (!weeksForRoom) return 0;

  const weekIndex = getRatesWeekIndex(fecha);
  const weekRates = weeksForRoom[weekIndex];
  if (!weekRates) return 0;

  const key = isWeekend(fecha) ? 'weekend' : 'weekday';
  const base = weekRates[key];
  return typeof base === 'number' ? base : 0;
}

export function calcularTotalPorRangoFechas({
  tipoHabitacionId,
  fechaInicio,
  fechaFin,
  adultos,
  ninos,
}) {
  if (!fechaInicio || !fechaFin) return 0;

  const inicio = new Date(
    fechaInicio.getFullYear(),
    fechaInicio.getMonth(),
    fechaInicio.getDate()
  );
  const fin = new Date(
    fechaFin.getFullYear(),
    fechaFin.getMonth(),
    fechaFin.getDate()
  );

  if (!(inicio < fin)) return 0;

  let total = 0;
  const cursor = new Date(inicio);

  // Iteramos noche a noche: desde inicio inclusive hasta el día anterior a fin
  while (cursor < fin) {
    const base = getNightBaseRate(tipoHabitacionId, cursor);
    const costoAdultos = adultos * base;
    const costoNinos = ninos * base;
    total += costoAdultos + costoNinos;

    cursor.setDate(cursor.getDate() + 1);
  }

  return total;
}